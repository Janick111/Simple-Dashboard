{% extends "bootstrap/base.html" %}

{% block title %}Sales Dashboard{% endblock %}

{% block styles %}
{{super()}}
<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
<link href="{{ url_for('static', filename='css/styles.css') }}" rel="stylesheet">
{% endblock %}

{% block content %}
<nav class="navbar navbar-expand-lg navbar-light bg-light">
  <a class="navbar-brand" href="#">Dashboard</a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="navbarNav">
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link" href="/">Dashboard</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/add-sales">Manage Sales Data</a>
      </li>
    </ul>
  </div>
</nav>

<div class="container">
    <h1 class="text-center mt-4 mb-4">Sales Dashboard</h1>
    
    <div class="row">
        <div class="col-md-3">
            <div class="metric">
                <h4>Total Sales</h4>
                <div class="metric-value">€{{ "{:,.2f}".format(stats.total_sales) }}</div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="metric">
                <h4>Average Sales</h4>
                <div class="metric-value">€{{ "{:,.2f}".format(stats.average_sales) }}</div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="metric">
                <h4>Max Sales</h4>
                <div class="metric-value">€{{ "{:,.2f}".format(stats.max_sales) }}</div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="metric">
                <h4>Min Sales</h4>
                <div class="metric-value">€{{ "{:,.2f}".format(stats.min_sales) }}</div>
            </div>
        </div>
    </div>

    <form method="post" class="mb-4">
        <div class="form-group">
            <label for="view">Select View:</label>
            <select name="view" id="view" class="form-control" onchange="this.form.submit()">
                <option value="monthly" {% if view == 'monthly' %}selected{% endif %}>Monthly</option>
                <option value="quarterly" {% if view == 'quarterly' %}selected{% endif %}>Quarterly</option>
                <option value="yearly" {% if view == 'yearly' %}selected{% endif %}>Yearly</option>
            </select>
        </div>
        <div class="form-group">
            <label for="category">Select Category:</label>
            <select name="category" id="category" class="form-control" onchange="this.form.submit()">
                <option value="All">All</option>
                {% for cat in categories_info.all_categories %}
                    <option value="{{ cat }}" {% if categories_info.selected == cat %}selected{% endif %}>{{ cat }}</option>
                {% endfor %}
            </select>
        </div>
    </form>

    <div class="chart-container mb-4">
        <h2 class="text-center">Bar Chart</h2>
        {{ graphs.bar_graph_html | safe }}
    </div>

    <div class="chart-container mb-4">
        <h2 class="text-center">Line Chart</h2>
        {{ graphs.line_graph_html | safe }}
    </div>
</div>
{% endblock %}

{% block scripts %}
{{super()}}
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
{% endblock %}